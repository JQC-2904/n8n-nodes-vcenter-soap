vCenter SOAP Node for n8n (Node.js v24.x)
Minimal Base Implementation Guide for Codex (Connection Test Only)

Goal

Build a minimal, correct, and robust base for a custom n8n community node compatible with Node.js v24.x that connects to VMware vCenter via the vSphere SOAP API (vim25).

This phase MUST implement only:

Credentials

SOAP transport

Session handling

A reliable Test connection operation

Do NOT implement inventory traversal
Do NOT implement VM operations
Do NOT optimize or modernize transport

The only objective is to successfully perform a SOAP connection test exactly like curl.

Scope and desired outcome

We want an npm package that can be linked into n8n and that can:

Open a valid HTTPS connection to vCenter SOAP

Perform SOAP calls over HTTP/1.1

Authenticate via SessionManager

Return basic server identity

If this base works reliably, features will be added later.

SOAP endpoint rules (non-negotiable)

All SOAP requests MUST be sent to:

https://<vcenter-host>/sdk/vimService

Important clarifications:

The WSDL endpoint (/sdk/vimService.wsdl) is ONLY for downloading the WSDL

/sdk alone is NOT a valid SOAP endpoint

Never infer or guess the endpoint

Normalize any user-provided URL so that all SOAP POSTs go to /sdk/vimService

HTTP protocol rules (strict)

vCenter SOAP is legacy and fragile.

The implementation MUST behave like a working curl command using HTTP/1.1 POST.

Mandatory rules:

HTTP/1.1 only

POST only

No HTTP/2

No fetch

No undici

No Axios

No proxies

No chunked request encoding

No automatic body transformations

If vCenter returns an error mentioning “expat parser”, “invalid token”, or “before method was determined”, it means the server did NOT receive a valid HTTP POST.

Transport implementation (mandatory)

All SOAP calls MUST be implemented using Node.js built-in https.request.

Do not use Axios, fetch, undici, or any higher-level HTTP client.

You must have full manual control over:

Method

Headers

Body bytes

TLS options

Required HTTP headers (exact, no extras)

Every SOAP request MUST include ONLY the following headers:

Host set to the vCenter hostname

Content-Type set to text/xml; charset=utf-8

Accept set to text/xml

SOAPAction set to urn:vim25/7.0

Content-Length set to the exact UTF-8 byte length of the body

Connection set to close

No additional headers are allowed.

TLS requirements

Use HTTPS only

Support private CA and lab certificates

Expose a credential option to allow insecure TLS

When insecure TLS is enabled, disable certificate verification

Set TLS SNI correctly using the vCenter hostname

Do not enable or negotiate HTTP/2

Do not inject ALPN options

SOAP fundamentals (vim25)

Authentication is done using SessionManager.Login

A successful login returns a cookie named vmware_soap_session

This cookie MUST be sent in all subsequent SOAP requests

Store the session cookie in memory per execution

Re-authenticate if the session is missing or invalid

SOAP calls required for the connection test

Only these calls are required at this stage.

8.1 RetrieveServiceContent

Purpose:

Verify the SOAP endpoint is reachable

Retrieve server identity information

Obtain the SessionManager reference

Expected behavior:

about.apiType must be VirtualCenter

about.fullName must be present

8.2 Login (SessionManager)

Purpose:

Authenticate the user

Obtain the vmware_soap_session cookie

Behavior:

Capture Set-Cookie

Persist the session cookie

Fail clearly if authentication fails

8.3 Test connection operation (required behavior)

The Test connection operation MUST:

Call RetrieveServiceContent

Call Login

Call RetrieveServiceContent again

Return a JSON object indicating successful connection, including:

connected true

apiType

fullName

version

build

n8n node package structure (mandatory)

The project MUST follow the standard n8n community node layout so it can be built, installed, and loaded correctly.

Required high-level structure:

package.json with:

name starting with n8n-nodes-

main pointing to dist/index.js

types pointing to dist/index.d.ts

scripts for build (tsc) and lint if needed

n8n metadata section declaring nodes and credentials entry points

dependencies only for runtime libraries

devDependencies for TypeScript tooling

peerDependencies for n8n packages (n8n-workflow and n8n-core)

tsconfig.json configured for TypeScript build output to dist/

src/ folder containing:

src/index.ts as the package entrypoint exporting nodes and credentials

src/nodes/ containing the node implementation

src/credentials/ containing the credential type implementation

src/helpers/ containing the SOAP transport client (https.request based)

dist/ folder generated by build (TypeScript output)

dist must be generated by npm run build

dist should not be hand-edited

Required source files (minimum):

src/index.ts

exports the node classes and credential classes so n8n can load them

src/credentials/VCenterSoapApi.credentials.ts

defines the credential fields (server URL, username, password, insecure TLS, timeout)

defines credential test request or uses the node test operation (depending on chosen n8n pattern)

src/nodes/VCenterSoap/VCenterSoap.node.ts

defines the node’s properties and operations

includes an operation “Test connection” that runs the SOAP test flow

src/helpers/soapClient.ts

implements the raw HTTPS SOAP transport using https.request

handles endpoint normalization and session cookie persistence

returns raw XML responses and surfaces SOAP faults cleanly

Naming requirements:

Node display name: VCenter SOAP

Node internal name: vCenterSoap (or similar consistent camelCase)

Credential name: vCenterSoapApi (or similar)

Build requirements:

npm run build must compile TypeScript to dist/ with .js and .d.ts outputs

The node must be loadable in n8n from the compiled dist output

Credentials (n8n)

Credential fields:

Server URL (example: https://vcsa.example.com

)

Username

Password (masked)

Optional fields:

Allow insecure TLS (boolean)

Request timeout in milliseconds

Debugging requirements (mandatory)

When debug mode is enabled, the node MUST log:

Final SOAP endpoint URL

HTTP method

All request headers

Content-Length

First 100 characters of the SOAP body

HTTP status code

First 200 characters of the response body

These logs are required to diagnose SOAP transport problems.

Absolute rules for Codex

Do NOT implement VM logic yet

Do NOT modernize transport

Do NOT use Axios

Do NOT assume defaults

Do NOT hide transport errors

If curl works and this node does not, the implementation is incorrect.
